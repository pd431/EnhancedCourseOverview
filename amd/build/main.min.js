/**
 * JavaScript for enhanced course overview
 *
 * @module     block_enhanced_course_overview/main
 * @copyright  2025 Your Name
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/templates","block_myoverview/repository","block_enhanced_course_overview/repository"],(function(e,r,t,o){return{init:function(e){const t=e.blockid,c=document.querySelector(`#instance-${t}-header + .card-body .enhanced-course-overview-container`);if(!c)return;const n=window.enhancedCourseOverviewCourses||[];let i=window.enhancedCourseOverviewFilteredCourses||[];a(i);function s(e,r,t){return o.checkCourseFilter(e,r,t)}async function a(e){const t=c.querySelector("#enhanced-overview-courses-container");if(t)try{if(0===e.length){const e=await r.render("core_course/no-courses",{nocoursesimg:M.cfg.wwwroot+"/blocks/myoverview/pix/courses.svg"});return void(t.innerHTML=e)}const o=function(){const e=localStorage.getItem("block_myoverview_user_view_preference");if(e)return e;return"card"}(),c={courses:e};let n;switch(o){case"list":n="block_myoverview/view-list";break;case"summary":n="block_myoverview/view-summary";break;default:n="block_myoverview/view-cards"}const i=await r.render(n,c);t.innerHTML=i,r.runTemplateJS(i)}catch(e){console.error("Error rendering courses:",e)}}c.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",(e=>{const r=e.currentTarget;if("timeframe"===r.dataset.type){const e=r.closest(".year-term-group");if(e){e.querySelectorAll(".term-btn").forEach((e=>{e!==r&&e.classList.remove("active")}))}}r.classList.toggle("active"),function(){const e={};c.querySelectorAll(".filter-btn.active").forEach((r=>{const t=r.dataset.type,o=r.dataset.value;e[t]||(e[t]=[]),e[t].push(o)})),i=0===Object.keys(e).length?n:function(e,r){return e.filter((e=>{let t=!0;for(const o in r){if(!r[o].length)continue;let c=!1;for(const t of r[o])if(s(e,o,t)){c=!0;break}if(!c){t=!1;break}}return t}))}(n,e);a(i),function(e){const r=JSON.stringify(e);localStorage.setItem("block_enhanced_course_overview_filters",r)}(e)}()}))}))}}}));